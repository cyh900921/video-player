<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Canvas Video Player</title>
<style>
  body {
    background:black; margin:0;
    display:flex; flex-direction:column;
    justify-content:center; align-items:center;
    height:100vh;
  }
  canvas {
    background:black;
    max-width:100vw;
    max-height:80vh;
  }
</style>
</head>

<body>

<!-- 不可 display:none，否則不能出聲 -->
<video id="v" playsinline muted
  style="position:absolute; left:-9999px; top:-9999px; width:1px; height:1px;"
>
  <source src="完整影片.mp4" type="video/mp4">
</video>

<canvas id="c"></canvas>

<script>
const video = document.getElementById("v");
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let loopCount = 0;
const MAX_LOOP = 6;

// 畫面渲染
function draw() {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  if (!video.paused && !video.ended) {
    requestAnimationFrame(draw);
  }
}

// 影片載入後設定 canvas 尺寸
video.addEventListener("loadedmetadata", () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
});

// 循環 6 次播放
video.addEventListener("ended", () => {
  loopCount++;
  if (loopCount < MAX_LOOP) {
    video.currentTime = 0;
    video.play().then(() => {
      requestAnimationFrame(draw);
    });
  }
});

// ⭐ 自動播放：等待真正開始播放後再畫第一幀
video.addEventListener("canplay", async () => {
  try {
    await video.play();    // 等待成功播放（必要）
    requestAnimationFrame(draw);

    // 開聲音（iPhone 只要已經播放，就能取消靜音）
    setTimeout(() => {
      video.muted = false;
      video.volume = 1.0;
    }, 300);

  } catch (err) {
    console.log("Autoplay blocked:", err);
  }
});
</script>

</body>
</html>
